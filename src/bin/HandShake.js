const _0x11d80d=_0x3dc5;(function(_0x47728e,_0x395c98){const _0x244d1c=_0x3dc5;const _0x21abe0=_0x47728e();while(!![]){try{const _0x4dd007=-parseInt(_0x244d1c(0x46))/0x1+-parseInt(_0x244d1c(0x6d))/0x2+parseInt(_0x244d1c(0x3a))/0x3*(parseInt(_0x244d1c(0x6b))/0x4)+-parseInt(_0x244d1c(0x1f))/0x5+-parseInt(_0x244d1c(0x38))/0x6*(-parseInt(_0x244d1c(0x5a))/0x7)+parseInt(_0x244d1c(0x1d))/0x8+-parseInt(_0x244d1c(0x22))/0x9;if(_0x4dd007===_0x395c98){break;}else{_0x21abe0['push'](_0x21abe0['shift']());}}catch(_0x286c0e){_0x21abe0['push'](_0x21abe0['shift']());}}}(_0x422a,0x28a3b));var _0xcc;const CipherState=require(_0x11d80d(0x5e));_0xcc=0x6;const WASymmetricState=require(_0x11d80d(0x39));var _0x;const HandshakeState=require(_0x11d80d(0x4c));_0x=0x0+0x9;var _0x2=0x2+0x7;const SwitchableHandshakeState=require(_0x11d80d(0x1a));function _0x3dc5(_0x470d1b,_0x422a6f){const _0x3dc5cb=_0x422a();_0x3dc5=function(_0x381246,_0x2258c4){_0x381246=_0x381246-0x0;let _0x17e75c=_0x3dc5cb[_0x381246];return _0x17e75c;};return _0x3dc5(_0x470d1b,_0x422a6f);}_0x2=0x4+0x0;var _0x1be;const IKHandshakePattern=require(_0x11d80d(0x4d));_0x1be=0x2+0x4;function _0x422a(){const _0x5571d2=['read_message','2855502bsDaeX','tag24','edgeRoutingInfo','switchHandshakeXXFallback','000','EDGE_HEADER','mnc','pushName','write_message','debug','start\x20use\x20switchHandshakeXXFallback','start','createPayload','CAwIBQ==','encrypt','modify','random','startHandshakeIK','sendCipherState','send\x20local\x20public\x20key','string','from','655710fUqmTe','../protocol/WASymmetricState','7008CwjmyJ','exports','encryptAES256GCM','initialize','aTAGI','ephemeral','finish','slice','decryptAES256GCM','generatePushName','dkhn','static','4869JbddgP','kFdjl','HEADER','manufacturer','decrypt','fknm','../protocol/HandshakeState','../protocol/handshakepatterns/IKHandshakePattern','concat','clientStaticKeypair','tag23','data','isLogin','AESGCM','handshakeState','C2S','alloc','LZQDm','start\x20use\x20startHandshakeXX','platform','14iiFZyp','client\x20info:','recv\x20server\x20public\x20key','toString','../protocol/CipherState','toJSON','send\x20client\x20finish\x20buffer.','dnfo','../protocol/FallbackPatternModifier','toBuffer','fdid','unknown','xwmBs','floor','encode','once','length','440STzzEF','mcc','221812JLaSsm','jkXnJ','client\x20version:','version','HandshakeMessage','start\x20use\x20startHandshakeIK','abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ','split','YMWwu','oSVersion','waSocketClient','mobile','payload','create','deviceName','../protobuf/pb','recvCipherState','send','switch','serverHello','undefined','cfdp','base64','info','public','Handshake\x20success.','../protocol/handshakepatterns/XXHandshakePattern','../protocol/SwitchableHandshakeState','BSkBH','account:','2464584WYiBjc','decode','920455dBRZcg','startHandshakeXX'];_0x422a=function(){return _0x5571d2;};return _0x422a();}const FallbackPatternModifier=require(_0x11d80d(0x62));const XXHandshakePattern=require(_0x11d80d(0x19));const {ClientHello,HandshakeMessage}=require(_0x11d80d(0xe));class HandShake{constructor(_0x32403c){const _0x3ee6b9=_0x3dc5;this['waSocketClient']=_0x32403c;const _0x433498=0xda230^0xda235;const _0x42174b=0xb7aa5^0xb7aa7;const _0xd43435=Buffer['from']([_0x433498,_0x42174b]);this['HEADER']=Buffer['concat']([Buffer['from']('WA'),_0xd43435]);this['EDGE_HEADER']=Buffer['concat']([Buffer['from']('ED'),Buffer['from']([0xbcc32^0xbcc32,0x23f9f^0x23f9e])]);var _0x1010c4=0x1+0x4;const _0x508fae=new CipherState(_0x3ee6b9(0x53));_0x1010c4=0x9+0x9;const _0x3dfd75=new WASymmetricState(_0x508fae);this['handshakeState']=new SwitchableHandshakeState(new HandshakeState(_0x3dfd75));this['isLogin']=![];}get['rs'](){return this['handshakeState']['rs']||null;}async['start'](_0x61c233,_0x2e97a5){let _0x3775e9=Buffer['from'](_0x61c233['clientStaticKeypair'],'base64');_0x3775e9={'private':_0x3775e9['slice'](0x758b3^0x758b3,0x4ae06^0x4ae26),'public':_0x3775e9['slice'](-(0xe3b06^0xe3b26))};let _0x10fde0;if(_0x2e97a5){if('BSkBH'!=='YMWwu'){console['debug']('start\x20use\x20startHandshakeIK');_0x10fde0=await this['startHandshakeIK'](_0x61c233,_0x3775e9,_0x2e97a5);}else{return this['recvCipherState']['decryptAES256GCM'](_0xb56f39['alloc'](0x0),this['toBuffer'](_0x7deb50));}}else{console['debug']('start\x20use\x20startHandshakeXX');_0x10fde0=await this['startHandshakeXX'](_0x61c233,_0x3775e9);}console['info']('Handshake\x20success.');return _0x10fde0;}async['startHandshakeXX'](_0x18b9db,_0x1314f7){return new Promise(_0x18e132=>{var _0x50ce38=0x7+0x6;const _0x2d8ba0=new XXHandshakePattern();_0x50ce38='cfdp';this['handshakeState']['initialize'](_0x2d8ba0,!![],this['HEADER'],_0x1314f7);this['waSocketClient']['send'](this['HEADER'],![]);this['handshakeState']['write_message'](Buffer['alloc'](0xc1e55^0xc1e55),[]);const _0x2f122f=this['handshakeState']['e']['public'];console['debug']('send\x20local\x20public\x20key',_0x2f122f,_0x2f122f['toString']('base64'));const _0x95dc9e=HandshakeMessage['HandshakeMessage']['encode'](HandshakeMessage['HandshakeMessage']['create']({'clientHello':{'ephemeral':_0x2f122f}}))['finish']();this['waSocketClient']['send'](_0x95dc9e);this['waSocketClient']['once']('data',async _0x2528ce=>{if('aTAGI'==='xwmBs'){return this['sendCipherState']['encryptAES256GCM'](_0xa0a3c2['alloc'](0x51608^0x51608),this['toBuffer'](_0x77e39e));}else{console['debug']('recv\x20server\x20public\x20key',_0x2528ce);const {serverHello:_0xcd61ac}=HandshakeMessage['HandshakeMessage']['decode'](_0x2528ce)['toJSON']();console['debug']('serverHello',_0xcd61ac);const _0x1d30e9=Buffer['concat']([Buffer['from'](_0xcd61ac['ephemeral'],'base64'),Buffer['from'](_0xcd61ac['static'],'base64'),Buffer['from'](_0xcd61ac['payload'],'base64')]);this['handshakeState']['read_message'](_0x1d30e9,[]);const _0x1cdf96=this['createPayload'](_0x18b9db);const _0x392965=[];const _0x147db3=this['handshakeState']['write_message'](_0x1cdf96,_0x392965);var _0x3b4214=0x3+0x3;const _0x3ced9c=Buffer['from'](_0x392965);_0x3b4214=0x2+0x7;var _0x31809d=0x3+0x2;const _0x2a3a0e=HandshakeMessage['HandshakeMessage']['encode'](HandshakeMessage['HandshakeMessage']['create']({'clientFinish':{'static':_0x3ced9c['slice'](0x2dc04^0x2dc04,0x9ff39^0x9ff09),'payload':_0x3ced9c['slice'](0x30)}}))['finish']();_0x31809d=0x5;this['waSocketClient']['send'](_0x2a3a0e);console['debug']('send\x20client\x20finish\x20buffer.');[this['sendCipherState'],this['recvCipherState']]=_0x147db3;this['isLogin']=!![];_0x18e132(_0x147db3);}});});}async['startHandshakeIK'](_0x4c0f3c,_0x231804,_0x5a398e){const _0x3c61d0=new IKHandshakePattern();this['handshakeState']['initialize'](_0x3c61d0,!![],this['HEADER'],_0x231804,null,_0x5a398e);const _0x5e5e13=this['createPayload'](_0x4c0f3c);const _0x5e53a2=[];this['handshakeState']['write_message'](_0x5e5e13,_0x5e53a2);var _0xfc96e;const _0x7a8f47=Buffer['from'](_0x5e53a2);_0xfc96e='dnfo';const _0xd14f84=_0x7a8f47['slice'](0x2fc87^0x2fc87,0x9a17d^0x9a15d);var _0x1f4014=0x2+0x8;const _0x4412b3=_0x7a8f47['slice'](0x20,(0xd9c7d^0xd9c5d)+(0x2ab9d^0x2abad));_0x1f4014='fknm';var _0x2f2403=0x9+0x7;const _0x27a25e=_0x7a8f47['slice'](0x20+(0x9ea0d^0x9ea3d));_0x2f2403=0x6+0x7;var _0x201bf4=0x6+0x3;const _0x2e06eb=HandshakeMessage['HandshakeMessage']['encode'](HandshakeMessage['HandshakeMessage']['create']({'clientHello':{'ephemeral':_0xd14f84,'static':_0x4412b3,'payload':_0x27a25e}}))['finish']();_0x201bf4='dkhn';this['waSocketClient']['send'](this['EDGE_HEADER'],![]);this['waSocketClient']['send'](_0x4c0f3c['edgeRoutingInfo']||'CAwIBQ==');this['waSocketClient']['send'](this['HEADER'],![]);this['waSocketClient']['send'](_0x2e06eb);return new Promise((_0x59aee6,_0x58249b)=>{if('LZQDm'!=='LZQDm'){this['waSocketClient']=_0x18fb93;const _0x1662a1=0xda230^0xda235;const _0x4d838a=0xb7aa5^0xb7aa7;const _0x59a624=_0x3582e1['from']([_0x1662a1,_0x4d838a]);this['HEADER']=_0x3e2493['concat']([_0x36ff1c['from']('WA'),_0x59a624]);this['EDGE_HEADER']=_0x296b34['concat']([_0x3561ef['from']('ED'),_0x50980c['from']([0xbcc32^0xbcc32,0x23f9f^0x23f9e])]);var _0x196e05=0x1+0x4;const _0x2edb16=new _0x53c7f7('AESGCM');_0x196e05=0x9+0x9;const _0x5223a9=new _0x1651a0(_0x2edb16);this['handshakeState']=new _0x4a9a39(new _0x51efe3(_0x5223a9));this['isLogin']=![];}else{this['waSocketClient']['once']('data',async _0x106f83=>{const {serverHello:_0x3aba2b}=HandshakeMessage['HandshakeMessage']['decode'](_0x106f83)['toJSON']();console['debug']('serverHello',_0x3aba2b);if(_0x3aba2b['static']&&_0x3aba2b['static']['length']){console['info']('start\x20use\x20switchHandshakeXXFallback');const _0x431b3f=await this['switchHandshakeXXFallback'](_0x231804,_0x5e5e13,_0x3aba2b);_0x59aee6(_0x431b3f);return;}_0x3aba2b['static']=Buffer['alloc'](0x0);if(_0x3aba2b['static']&&_0x3aba2b['static']['length']){_0x3aba2b['static']=Buffer['from'](_0x3aba2b['static'],'base64');}const _0x46274c=Buffer['concat']([Buffer['from'](_0x3aba2b['ephemeral'],'base64'),_0x3aba2b['static'],Buffer['from'](_0x3aba2b['payload'],'base64')]);var _0x312d13;const _0x5e18d2=this['handshakeState']['read_message'](_0x46274c,[]);_0x312d13=0x4;[this['sendCipherState'],this['recvCipherState']]=_0x5e18d2;this['isLogin']=!![];_0x59aee6(_0x5e18d2);});}});}async['switchHandshakeXXFallback'](_0x89d08,_0x880544,_0x3f8d1c){console['debug']('switchHandshakeXXFallback');this['handshakeState']['switch'](new FallbackPatternModifier()['modify'](new XXHandshakePattern()),!![],this['HEADER'],_0x89d08);const _0x4f9299=[];const _0xed6561=Buffer['concat']([Buffer['from'](_0x3f8d1c['ephemeral'],'base64'),Buffer['from'](_0x3f8d1c['static'],'base64'),Buffer['from'](_0x3f8d1c['payload'],'base64')]);this['handshakeState']['read_message'](_0xed6561,_0x4f9299);const _0x332b1d=[];const _0x266421=this['handshakeState']['write_message'](_0x880544,_0x332b1d);const _0xe3b8bb=Buffer['from'](_0x332b1d);const _0x6f01cf=HandshakeMessage['HandshakeMessage']['encode'](HandshakeMessage['HandshakeMessage']['create']({'clientFinish':{'static':_0xe3b8bb['slice'](0x0,0x30),'payload':_0xe3b8bb['slice'](0x30)}}))['finish']();this['waSocketClient']['send'](_0x6f01cf);[this['sendCipherState'],this['recvCipherState']]=_0x266421;this['isLogin']=!![];return _0x266421;}['generatePushName'](){const _0x841ffb=_0x3dc5;const _0x379af0=_0x841ffb(0x5);const _0x32015e=Math['floor'](Math['random']()*(0x57b93^0x57b97)+(0x2372b^0x2372f));var _0xb33a2e=0x2+0x9;let _0x45bffe='';_0xb33a2e=0x0;const _0x5e4269=_0x379af0['length'];for(let _0x4c08d3=0x299bf^0x299bf;_0x4c08d3<_0x32015e;_0x4c08d3++){if(_0x841ffb(0x47)===_0x841ffb(0x0)){return this['handshakeState']['rs']||null;}else{_0x45bffe+=_0x379af0[Math['floor'](Math['random']()*_0x5e4269)];}}return _0x45bffe;}['createPayload'](_0x4ef7f2){const _0xf63930=_0x3dc5;console['debug'](_0xf63930(0x1),_0x4ef7f2['version']);console['debug'](_0xf63930(0x1c),_0x4ef7f2['cc'],_0x4ef7f2['mobile'],_0x4ef7f2['mcc'],_0x4ef7f2['mnc'],_0xf63930(0x59),_0x4ef7f2['platform']);console['debug'](_0xf63930(0x5b),_0x4ef7f2['oSVersion'],_0x4ef7f2['manufacturer'],_0x4ef7f2['deviceName']);const _0x455730=_0x4ef7f2['version']['split']('.');const _0x311e4b={'username':_0x4ef7f2['mobile'],'passive':![],'useragent':{'platform':_0x4ef7f2['platform']||0xde8db^0xde8db,'appVersion':{'primary':_0x455730[0x0],'secondary':_0x455730[0x19c4e^0x19c4f],'tertiary':_0x455730[0x2],'quaternary':_0x455730[0x3]},'mcc':_0x4ef7f2['mcc']||_0xf63930(0x26),'mnc':_0x4ef7f2['mnc']||_0xf63930(0x26),'osVersion':_0x4ef7f2['oSVersion'],'manufacturer':_0x4ef7f2['manufacturer'],'device':_0x4ef7f2['deviceName'],'osBuildNumber':_0x4ef7f2['oSVersion'],'phoneId':_0x4ef7f2['fdid']||'','localeLanguageIso_639_1':_0x4ef7f2['lg']||'en','localeCountryIso_3166_1Alpha_2':_0x4ef7f2['lc']||'US','device2':_0xf63930(0x65)},'pushName':_0x4ef7f2['pushName']||this['generatePushName'](),'sessionId':Math['floor'](Math['random']()*(0x63130^0x63132)**(0xaaa6c^0xaaa4c))+(0x49df7^0x49df6),'shortConnect':![],'connectType':0x1};if(Number(_0x4ef7f2['platform'])===0xa){_0x311e4b['tag23']=0x1;_0x311e4b['tag24']=0x5;}const _0xee4f9a=ClientHello['C2S'];const _0x466d59=_0xee4f9a['encode'](_0xee4f9a['create'](_0x311e4b))['finish']();return _0x466d59;}['toBuffer'](_0x421460){const _0x4cb499=_0x3dc5;if(typeof _0x421460===_0x4cb499(0x13))return Buffer['alloc'](0x0);return typeof _0x421460===_0x4cb499(0x36)?Buffer['from'](_0x421460,_0x4cb499(0x15)):Buffer['from'](_0x421460);}['decrypt'](_0x5a4c36){return this['recvCipherState']['decryptAES256GCM'](Buffer['alloc'](0x0),this['toBuffer'](_0x5a4c36));}['encrypt'](_0x106a08){return this['sendCipherState']['encryptAES256GCM'](Buffer['alloc'](0x51608^0x51608),this['toBuffer'](_0x106a08));}}module['exports']=HandShake;